<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>服务对象综合查询 - 居家长护业务管理系统</title>
  <!-- 引入外部资源 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  
  <style>
    /* 继承全局样式 */
    body { font-family: "微软雅黑", "思源黑体", sans-serif; background-color: #f5f7fa; color: #333; }
    .btn-primary { background-color: #1890FF; border-color: #1890FF; }
    .btn-primary:hover { background-color: #096DD9; border-color: #096DD9; }
    .btn-outline-secondary { border-color: #ddd; color: #666; }
    .btn-outline-secondary:hover { background-color: #f5f5f5; border-color: #ccc; }
    .btn-danger { background-color: #FF4D4F; border-color: #FF4D4F; }
    .btn-danger:hover { background-color: #F5222D; border-color: #F5222D; }
    .card { border: none; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
    .card-header { background: #fff; border-bottom: 1px solid #f0f0f0; border-radius: 12px 12px 0 0; padding: 15px 20px; font-weight: 600; font-size: 15px; }
    .card-body { padding: 20px; }
    /* 布局样式 */
    .app-container { display: flex; min-height: 100vh; }
    /* 侧边导航 */
    .sidebar { width: 220px; background: #fff; box-shadow: 1px 0 2px rgba(0,0,0,0.05); padding: 20px 0; flex-shrink: 0; }
    .sidebar-logo { text-align: center; padding: 0 20px 20px; border-bottom: 1px solid #f0f0f0; margin-bottom: 20px; }
    .sidebar-logo img { height: 40px; margin-bottom: 8px; }
    .sidebar-logo h3 { font-size: 16px; color: #1890FF; font-weight: 600; margin: 0; }
    .nav-menu { list-style: none; padding: 0; margin: 0; }
    .nav-item { margin-bottom: 4px; }
    .nav-link { display: flex; align-items: center; padding: 12px 20px; color: #666; text-decoration: none; font-size: 14px; border-left: 3px solid transparent; }
    .nav-link:hover, .nav-link.active { color: #1890FF; background-color: #f0f7ff; border-left: 3px solid #1890FF; }
    .nav-link i { font-size: 18px; margin-right: 12px; width: 20px; text-align: center; }
    .nav-group-title { padding: 15px 20px 5px; font-size: 12px; color: #999; font-weight: 500; }
    /* 主内容区 */
    .main-content { flex: 1; padding: 20px; overflow-y: auto; }
    /* 顶部导航 */
    .top-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .page-title { font-size: 20px; font-weight: 600; color: #333; margin: 0; }
    .user-info { display: flex; align-items: center; }
    .notification { position: relative; margin-right: 20px; cursor: pointer; }
    .notification i { font-size: 20px; color: #666; }
    .notification-badge { position: absolute; top: -5px; right: -5px; width: 18px; height: 18px; background: #FF4D4F; color: #fff; border-radius: 50%; font-size: 12px; text-align: center; line-height: 18px; }
    .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: #1890FF; color: #fff; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 600; margin-right: 10px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .user-avatar:hover { transform: scale(1.05); box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3); }
    .user-name { font-size: 14px; font-weight: 500; }
    /* 二维码模态框样式 */
    .qrcode-modal .modal-body { text-align: center; padding: 30px; }
    .qrcode-container { display: inline-block; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .qrcode-container canvas { display: block; margin: 0 auto; }
    .qrcode-info { text-align: left; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; }
    .qrcode-info-item { margin-bottom: 10px; font-size: 14px; }
    .qrcode-info-item:last-child { margin-bottom: 0; }
    .qrcode-info-label { color: #666; font-weight: 500; display: inline-block; width: 100px; }
    .qrcode-info-value { color: #333; }
    .qrcode-tip { color: #666; font-size: 13px; margin-top: 15px; line-height: 1.6; }
    
    /* 查询页面专属样式 */
    .filter-section { background: #fff; padding: 24px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .filter-row { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 18px; align-items: flex-end; }
    .filter-row:last-child { margin-bottom: 0; }
    .filter-item { flex: 1; min-width: 220px; display: flex; align-items: center; flex-wrap: wrap; }
    .filter-label { font-weight: 500; margin-right: 12px; white-space: nowrap; min-width: 90px; font-size: 14px; color: #333; flex-shrink: 0; }
    .form-control, .form-select { border-radius: 6px; border: 1px solid #ddd; font-size: 14px; flex: 1; min-width: 120px; height: 36px; padding: 6px 12px; transition: border-color 0.3s; }
    .form-control:focus, .form-select:focus { border-color: #1890FF; outline: none; box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1); }
    .date-range-group { display: flex; align-items: center; flex: 1; gap: 8px; }
    .date-range-group .form-control { flex: 0 0 auto; width: 150px; }
    .date-range-separator { color: #999; font-size: 14px; margin: 0 4px; white-space: nowrap; }
    .btn-filter { background: #1890FF; color: #fff; border: none; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s; display: inline-flex; align-items: center; gap: 6px; }
    .btn-filter:hover { background: #096DD9; transform: translateY(-1px); box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3); }
    .btn-filter:active { transform: translateY(0); }
    .btn-reset { background: #fff; color: #666; border: 1px solid #ddd; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s; display: inline-flex; align-items: center; gap: 6px; }
    .btn-reset:hover { background: #f5f5f5; border-color: #1890FF; color: #1890FF; }
    .filter-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px; padding-top: 16px; border-top: 1px solid #f0f0f0; }
    
    .data-table { background: #fff; border-radius: 8px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .table-header { background: #f8f9fa; padding: 16px 20px; font-weight: 600; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 12px; }
    .table-responsive { max-height: 500px; overflow-y: auto; overflow-x: auto; }
    .table { margin-bottom: 0; min-width: 100%; white-space: nowrap; }
    .table th, .table td { vertical-align: middle; padding: 14px 16px; border-bottom: 1px solid #f0f0f0; font-size: 14px; white-space: nowrap; text-overflow: ellipsis; }
    .table th { background: #f8f9fa; font-weight: 600; color: #333; position: sticky; top: 0; z-index: 10; }
    .table tbody tr:hover { background: #f5f7fa; transition: background-color 0.2s; }
    .table tbody tr:last-child td { border-bottom: none; }
    .checkbox-all { margin-right: 8px; cursor: pointer; }
    .checkbox-all, input[name="dataItem"] { cursor: pointer; width: 16px; height: 16px; }
    .text-danger { color: #FF4D4F !important; }
    .badge-warning { background-color: #FFF7E6; color: #FAAD14; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
    .status-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
    .btn-sm { padding: 6px 12px; font-size: 13px; border-radius: 4px; transition: all 0.2s; }
    .btn-sm:hover { transform: translateY(-1px); }
    .view-detail-btn { border: 1px solid #d9d9d9; color: #666; }
    .view-detail-btn:hover { border-color: #1890FF; color: #1890FF; background-color: #f0f7ff; }
    .status-normal { background-color: #E6F7E6; color: #52C41A; }
    .status-pause { background-color: #FFF7E6; color: #FAAD14; }
    .status-transfer { background-color: #E6F7FF; color: #1890FF; }
    .status-death { background-color: #FFE6E6; color: #FF4D4F; }
    
    .action-section { background: #fff; padding: 20px; border-radius: 8px; display: flex; flex-wrap: wrap; align-items: center; gap: 16px; justify-content: space-between; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .template-selector { flex: 1; min-width: 250px; display: flex; align-items: center; gap: 12px; }
    .template-selector .filter-label { margin-bottom: 0; }
    .btn-action { padding: 10px 24px; border-radius: 6px; font-weight: 500; cursor: pointer; font-size: 14px; transition: all 0.3s; display: inline-flex; align-items: center; gap: 6px; border: none; }
    .btn-validate { background: #1890FF; color: #fff; }
    .btn-validate:hover { background: #096DD9; transform: translateY(-1px); box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3); }
    .btn-export { background: #52C41A; color: #fff; }
    .btn-export:hover { background: #41A819; transform: translateY(-1px); box-shadow: 0 2px 8px rgba(82, 196, 26, 0.3); }
    .btn-disabled { background: #ccc !important; cursor: not-allowed !important; opacity: 0.6; }
    .btn-disabled:hover { background: #ccc !important; transform: none !important; box-shadow: none !important; }
    .action-buttons { display: flex; gap: 12px; flex-wrap: wrap; }
    
    .export-log { margin-top: 30px; }
    .log-header { font-weight: 600; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; font-size: 16px; color: #333; }
    .log-table { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    
    /* 模态框样式 */
    .modal-header { border-bottom: 1px solid #f0f0f0; }
    .modal-title { font-weight: 600; }
    .modal-body { max-height: 500px; overflow-y: auto; }
    .validation-result { margin-bottom: 15px; }
    .result-stats { display: flex; gap: 20px; margin-bottom: 15px; }
    .stat-item { display: flex; align-items: center; }
    .stat-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 8px; font-size: 12px; color: #fff; }
    .stat-success { background-color: #52C41A; }
    .stat-fail { background-color: #FF4D4F; }
    
    /* 详情模态框样式 */
    .detail-content { padding: 10px 0; }
    .detail-section { border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; }
    .detail-section:last-child { border-bottom: none; }
    .detail-section-title { color: #1890FF; font-weight: 600; font-size: 16px; padding-bottom: 10px; border-bottom: 2px solid #1890FF; }
    .detail-section-title i { margin-right: 8px; }
    
    /* 响应式布局 */
    @media (max-width: 1200px) {
      .filter-item { min-width: 180px; }
      .date-range-group .form-control { width: 130px; }
    }
    @media (max-width: 768px) {
      .filter-section { padding: 16px; }
      .filter-row { gap: 12px; margin-bottom: 12px; }
      .filter-item { min-width: 100%; flex: 0 0 100%; }
      .filter-label { min-width: 80px; }
      .date-range-group { width: 100%; }
      .date-range-group .form-control { width: calc(50% - 20px); }
      .filter-actions { flex-direction: column; }
      .filter-actions button { width: 100%; }
      .table-responsive { max-height: 400px; overflow-x: auto; }
      .table th, .table td { padding: 10px 12px; font-size: 13px; white-space: nowrap; }
      .detail-section-title { font-size: 14px; }
    }
    @media (max-width: 480px) {
      .main-content { padding: 12px; }
      .filter-section { padding: 12px; }
      .date-range-group { flex-direction: column; gap: 8px; }
      .date-range-group .form-control { width: 100%; }
      .date-range-separator { display: none; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- 侧边导航 -->
    <div class="sidebar">
      <div class="sidebar-logo">
          <img src="https://via.placeholder.com/80x40?text=居家长护" alt="系统Logo">
          <h3>管理员工作平台</h3>
      </div>
      
      <!-- 导航分组：系统配置 -->
      <div class="nav-group-title">系统配置</div>
      <ul class="nav-menu">
        <li class="nav-item">
            <a href="index.html" class="nav-link">
                <i class="fa fa-building-o"></i>
                <span>机构信息配置</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="套餐管理.html" class="nav-link">
                <i class="fa fa-cog"></i>
                <span>套餐管理</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="行政区划.html" class="nav-link">
                <i class="fa fa-book"></i>
                <span>行政区域管理</span>
            </a>
        </li>
    </ul>
    
    <!-- 导航分组：用户管理 -->
    <div class="nav-group-title">用户管理</div>
    <ul class="nav-menu">
        <li class="nav-item">
            <a href="角色配置.html" class="nav-link">
                <i class="fa fa-user-secret"></i>
                <span>角色权限配置</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="护理员管理.html" class="nav-link">
                <i class="fa fa-user-md"></i>
                <span>护理员管理</span>
            </a>
        </li>
        <li class="nav-item">
          <a href="服务对象管理.html" class="nav-link">
              <i class="fa fa-users"></i>
              <span>服务对象管理</span>
          </a>
      </li>
    </ul>
    
    <!-- 导航分组：日志管理 -->
    <div class="nav-group-title">数据管理</div>
    <ul class="nav-menu">
        <li class="nav-item">
            <a href="服务线索批量导入.html" class="nav-link">
                <i class="fa fa-upload"></i>
                <span>服务对象数据批量导入</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="服务对象数据维护.html" class="nav-link">
                <i class="fa fa-edit"></i>
                <span>服务对象数据维护</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="医保工单导入.html" class="nav-link">
                <i class="fa fa-file-excel-o"></i>
                <span>医保平台工单导入</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="医保平台新增服务对象数据.html" class="nav-link active">
                <i class="fa fa-download"></i>
                <span>医保平台新增服务对象数据导出</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="医保对账数据管理.html" class="nav-link">
                <i class="fa fa-calculator"></i>
                <span>医保对账数据管理</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="关键数据配置.html" class="nav-link">
                <i class="fa fa-wrench"></i>
                <span>业务数据维护</span>
            </a>
        </li>
    </ul>
  </div>
    <!-- 主内容区 -->
    <div class="main-content">
      <!-- 顶部导航：标题 + 操作按钮 -->
      <div class="top-nav">
        <h1 class="page-title">服务对象综合查询</h1>
        <div class="user-info">
          <div class="notification">
            <i class="fa fa-bell-o"></i>
            <span class="notification-badge">3</span>
          </div>
          <div class="user-avatar" id="userAvatar" title="点击生成App登录二维码">管</div>
          <div class="user-name">系统管理员</div>
        </div>
      </div>

      <!-- 筛选区域 -->
      <div class="filter-section">
        <div class="filter-row">
          <div class="filter-item">
            <label class="filter-label">姓名：</label>
            <input type="text" id="name" class="form-control" placeholder="支持模糊查询">
          </div>
          <div class="filter-item">
            <label class="filter-label">身份证号：</label>
            <input type="text" id="idCard" class="form-control" placeholder="支持模糊查询">
          </div>
          <div class="filter-item">
            <label class="filter-label">街道/乡镇：</label>
            <select id="street" class="form-select">
              <option value="">全部</option>
            </select>
          </div>
          <div class="filter-item">
            <label class="filter-label">社区/村屯：</label>
            <select id="community" class="form-select">
              <option value="">全部</option>
            </select>
          </div>
        </div>
        <div class="filter-row">
          <div class="filter-item">
            <label class="filter-label">小区/自然村：</label>
            <select id="cell" class="form-select">
              <option value="">全部</option>
            </select>
          </div>
          <div class="filter-item">
            <label class="filter-label">来源：</label>
            <select id="source" class="form-select">
              <option value="">全部</option>
              <option value="村镇提供">村镇提供</option>
              <option value="自行摸排">自行摸排</option>
              <option value="社区">社区</option>
              <option value="医保">医保</option>
            </select>
          </div>
          <div class="filter-item">
            <label class="filter-label">是否接收过服务：</label>
            <select id="hasReceivedService" class="form-select">
              <option value="">全部</option>
              <option value="是">是</option>
              <option value="否">否</option>
            </select>
          </div>
          <div class="filter-item">
            <label class="filter-label">年龄：</label>
            <div class="date-range-group">
              <input type="number" id="ageMin" class="form-control" placeholder="最小年龄" min="0" max="150">
              <span class="date-range-separator">至</span>
              <input type="number" id="ageMax" class="form-control" placeholder="最大年龄" min="0" max="150">
            </div>
          </div>
        </div>
        <div class="filter-row">
          <div class="filter-item">
            <label class="filter-label">失能等级：</label>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center; flex: 1;">
              <label style="margin: 0; font-weight: normal; cursor: pointer;">
                <input type="checkbox" name="disabilityLevel" value="轻度" style="margin-right: 5px;"> 轻度
              </label>
              <label style="margin: 0; font-weight: normal; cursor: pointer;">
                <input type="checkbox" name="disabilityLevel" value="中度" style="margin-right: 5px;"> 中度
              </label>
              <label style="margin: 0; font-weight: normal; cursor: pointer;">
                <input type="checkbox" name="disabilityLevel" value="重度一级" style="margin-right: 5px;"> 重度一级
              </label>
              <label style="margin: 0; font-weight: normal; cursor: pointer;">
                <input type="checkbox" name="disabilityLevel" value="重度二级" style="margin-right: 5px;"> 重度二级
              </label>
              <label style="margin: 0; font-weight: normal; cursor: pointer;">
                <input type="checkbox" name="disabilityLevel" value="重度三级" style="margin-right: 5px;"> 重度三级
              </label>
            </div>
          </div>
        </div>
        <div class="filter-row">
          <div class="filter-item">
            <label class="filter-label">服务状态：</label>
            <select id="serviceStatus" class="form-select">
              <option value="">全部</option>
              <option value="正常">正常</option>
              <option value="暂停">暂停</option>
              <option value="转出">转出</option>
              <option value="死亡">死亡</option>
            </select>
          </div>
          <div class="filter-item">
            <label class="filter-label">联系电话：</label>
            <input type="text" id="phone" class="form-control" placeholder="支持模糊查询">
          </div>
          <div class="filter-item">
            <label class="filter-label">排序字段：</label>
            <select id="sortField" class="form-select">
              <option value="">默认</option>
              <option value="name">姓名</option>
              <option value="age">年龄</option>
              <option value="createDate">创建日期</option>
              <option value="publishDate">公示日期</option>
            </select>
          </div>
          <div class="filter-item">
            <label class="filter-label">排序方式：</label>
            <select id="sortOrder" class="form-select">
              <option value="asc">升序</option>
              <option value="desc">降序</option>
            </select>
          </div>
        </div>
        <div class="filter-actions">
          <button id="queryBtn" class="btn-filter">
            <i class="fa fa-search"></i> 查询
          </button>
          <button id="resetBtn" class="btn-reset">
            <i class="fa fa-refresh"></i> 重置
          </button>
        </div>
      </div>

      <!-- 数据列表区域 -->
      <div class="data-table">
        <div class="table-header">
          <label>
            <input type="checkbox" id="checkAll" class="checkbox-all">
            <span>全选</span>
          </label>
          <span style="margin-left: 10px;">共 <strong id="totalCount">0</strong> 条数据</span>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th style="width: 60px;">选择</th>
                <th>姓名</th>
                <th>身份证号</th>
                <th>性别</th>
                <th>年龄</th>
                <th>联系电话</th>
                <th>行政区划</th>
                <th>来源</th>
                <th>是否接收过服务</th>
                <th>失能等级</th>
                <th>服务状态</th>
                <th>公示日期</th>
                <th>创建日期</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="dataList">
              <!-- 数据将通过JavaScript动态生成 -->
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <!-- 提示模态框 -->
  <div class="modal fade" id="promptModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-body text-center py-4">
          <i class="fa fa-info-circle text-primary" style="font-size: 36px; margin-bottom: 15px;"></i>
          <h5 class="modal-title" id="promptTitle">操作提示</h5>
          <p class="text-muted" id="promptMsg">正在处理，请稍后...</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">确定</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 详情模态框 -->
  <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fa fa-user"></i> 服务对象详情 - <span id="detailObjectName">-</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="detailModalBody" style="max-height: 70vh; overflow-y: auto;">
          <!-- 详情内容将通过JavaScript动态生成 -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 通知模态框 -->
  <div class="modal fade" id="notificationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fa fa-bell-o"></i> 系统通知
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="notificationList">
            <!-- 通知列表将通过JavaScript动态生成 -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
          <button type="button" class="btn btn-primary" id="markAllReadBtn">全部标记为已读</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 页面加载完成后初始化
    $(function() {
      // 初始化模态框
      const promptModal = new bootstrap.Modal('#promptModal');
      const notificationModal = new bootstrap.Modal('#notificationModal');
      const detailModal = new bootstrap.Modal('#detailModal');
      
      // 通知数据
      let notifications = [
        { id: 1, title: '数据导出完成', content: '服务对象数据导出已完成，共导出8条记录。', time: '2025-12-10 14:30:25', read: false, type: 'success' },
        { id: 2, title: '系统维护通知', content: '系统将于今晚22:00-24:00进行维护，期间可能无法访问。', time: '2025-12-10 10:15:00', read: false, type: 'warning' },
        { id: 3, title: '新功能上线', content: '医保平台新增服务对象数据导出功能已上线，欢迎使用。', time: '2025-12-09 09:00:00', read: false, type: 'info' }
      ];
      
      // 通知按钮点击事件
      $('.notification').click(function() {
        renderNotifications();
        notificationModal.show();
      });
      
      // 渲染通知列表
      function renderNotifications() {
        const notificationList = $('#notificationList');
        notificationList.empty();
        
        const unreadCount = notifications.filter(n => !n.read).length;
        $('.notification-badge').text(unreadCount > 0 ? unreadCount : '');
        $('.notification-badge').toggle(unreadCount > 0);
        
        if (notifications.length === 0) {
          notificationList.html('<div class="text-center text-muted py-4">暂无通知</div>');
          return;
        }
        
        notifications.forEach(notif => {
          const typeClass = {
            'success': 'text-success',
            'warning': 'text-warning',
            'info': 'text-info',
            'error': 'text-danger'
          }[notif.type] || 'text-info';
          
          const iconClass = {
            'success': 'fa-check-circle',
            'warning': 'fa-exclamation-circle',
            'info': 'fa-info-circle',
            'error': 'fa-times-circle'
          }[notif.type] || 'fa-info-circle';
          
          notificationList.append(`
            <div class="notification-item p-3 mb-2 border rounded ${notif.read ? '' : 'bg-light'}" data-id="${notif.id}">
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <div class="d-flex align-items-center mb-1">
                    <i class="fa ${iconClass} ${typeClass} me-2"></i>
                    <strong class="${notif.read ? '' : 'fw-bold'}">${notif.title}</strong>
                    ${!notif.read ? '<span class="badge bg-danger ms-2">未读</span>' : ''}
                  </div>
                  <p class="text-muted mb-1 small">${notif.content}</p>
                  <small class="text-muted">${notif.time}</small>
                </div>
                ${!notif.read ? '<button class="btn btn-sm btn-link mark-read-btn" data-id="' + notif.id + '">标记已读</button>' : ''}
              </div>
            </div>
          `);
        });
      }
      
      // 标记单个通知为已读
      $(document).on('click', '.mark-read-btn', function() {
        const id = parseInt($(this).data('id'));
        const notif = notifications.find(n => n.id === id);
        if (notif) {
          notif.read = true;
          renderNotifications();
        }
      });
      
      // 全部标记为已读
      $('#markAllReadBtn').click(function() {
        notifications.forEach(n => n.read = true);
        renderNotifications();
      });
      
      // 初始化通知显示
      renderNotifications();

      // 设置默认日期范围（设置为空，不限制日期范围，确保能显示所有数据）
      // 如果需要限制日期范围，可以取消下面的注释
      // const today = new Date();
      // const oneYearAgo = new Date();
      // oneYearAgo.setFullYear(today.getFullYear() - 1);
      // $('#publishStartDate').val(formatDate(oneYearAgo));
      // $('#publishEndDate').val(formatDate(today));

      // 全局变量
      let selectedRows = [];  // 选中的数据行ID
      let allData = [];       // 所有查询到的数据

      // 页面加载时自动查询
      queryData();
      
      // 初始化行政区划级联选择
      initRegionCascade();

      // 查询按钮点击事件
      $('#queryBtn').click(queryData);
      
      // 重置按钮点击事件
      $('#resetBtn').click(function() {
        // 清空所有筛选条件
        $('#name').val('');
        $('#idCard').val('');
        $('#street').val('');
        $('#community').val('');
        $('#cell').val('');
        $('#source').val('');
        $('#hasReceivedService').val('');
        $('#ageMin').val('');
        $('#ageMax').val('');
        $('input[name="disabilityLevel"]').prop('checked', false);
        $('#serviceStatus').val('');
        $('#phone').val('');
        $('#sortField').val('');
        $('#sortOrder').val('asc');
        
        // 重新查询
        queryData();
      });

      // 全选/取消全选
      $('#checkAll').change(function() {
        const isChecked = $(this).prop('checked');
        $('input[name="dataItem"]').prop('checked', isChecked);
        
        // 更新选中的行ID数组
        selectedRows = isChecked ? 
          allData.map(item => item.id) : 
          [];
        
        updateExportButtonStatus();
      });

      // 单个数据行选择
      $(document).on('change', 'input[name="dataItem"]', function() {
        const id = $(this).val();
        const isChecked = $(this).prop('checked');
        
        if (isChecked) {
          if (!selectedRows.includes(id)) {
            selectedRows.push(id);
          }
        } else {
          selectedRows = selectedRows.filter(item => item !== id);
        }
        
        // 更新全选框状态
        const totalItems = $('input[name="dataItem"]').length;
        const checkedItems = $('input[name="dataItem"]:checked').length;
        $('#checkAll').prop('checked', totalItems > 0 && totalItems === checkedItems);
      });


      // 查看详情按钮点击事件
      $(document).on('click', '.view-detail-btn', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const id = $(this).data('id');
        // 尝试多种ID匹配方式（字符串和数字）
        const item = allData.find(item => {
          return item.id === id || 
                 item.id === String(id) || 
                 String(item.id) === String(id);
        });
        
        if (!item) {
          console.error('未找到对应的数据项，ID:', id, 'allData长度:', allData.length);
          alert('未找到对应的数据信息，请刷新页面重试');
          return;
        }
        
        // 生成详情HTML（采用服务对象数据维护的表单格式，所有字段只读）
        const age = item.birthDate ? calculateAge(item.birthDate) : '';
        const gender = item.gender || '';
        const idCard = item.idCard || item.selfid || '';
        const phoneNum = item.phone || item.phoneNum || '';
        const address = item.address || '';
        const markAddr = item.markAddr || '';
        const latitude = item.latitude || '';
        const longitude = item.longitude || '';
        const fileId = item.fileId || '';
        
        // 辅助函数：生成只读输入框
        const readonlyInput = (value, placeholder = '') => {
          return `<input type="text" class="form-control" value="${value || ''}" placeholder="${placeholder}" readonly>`;
        };
        
        // 辅助函数：生成只读日期输入框
        const readonlyDate = (value) => {
          return `<input type="date" class="form-control" value="${value || ''}" readonly>`;
        };
        
        // 辅助函数：生成只读下拉框
        const readonlySelect = (value, options) => {
          let html = `<select class="form-select" disabled>`;
          html += `<option value="">请选择</option>`;
          options.forEach(opt => {
            const selected = opt.value === value ? 'selected' : '';
            html += `<option value="${opt.value}" ${selected}>${opt.label}</option>`;
          });
          html += `</select>`;
          return html;
        };
        
        // 失能等级选项
        const disLevelOptions = [
          { value: '轻度', label: '轻度' },
          { value: '中度', label: '中度' },
          { value: '重度一级', label: '重度（一级）' },
          { value: '重度二级', label: '重度（二级）' },
          { value: '重度三级', label: '重度（三级）' }
        ];
        
        // 性别选项
        const genderOptions = [
          { value: '男', label: '男' },
          { value: '女', label: '女' }
        ];
        
        // 是否选项
        const yesNoOptions = [
          { value: '1', label: '是' },
          { value: '0', label: '否' }
        ];
        
        // 失能原因选项
        const disReasonOptions = [
          { value: '疾病', label: '疾病' },
          { value: '意外', label: '意外' },
          { value: '年老', label: '年老' },
          { value: '其他', label: '其他' }
        ];
        
        // 代理人关系选项
        const relationOptions = [
          { value: '1', label: '配偶' },
          { value: '2', label: '子女' },
          { value: '3', label: '父母' },
          { value: '4', label: '其他' }
        ];
        
        // 医保类型选项
        const medicalTypeOptions = [
          { value: '职工医保', label: '职工医保' },
          { value: '城乡居民医保', label: '城乡居民医保' },
          { value: '居民医保', label: '居民医保' },
          { value: '其他', label: '其他' }
        ];
        
        let detailHtml = `
          <form>
            <!-- 基本信息 -->
            <h6 class="mb-3 text-primary border-bottom pb-2">基本信息</h6>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">档案编号</label>
                ${readonlyInput(fileId)}
              </div>
              <div class="col-md-6">
                <label class="form-label">姓名 <span class="text-danger">*</span></label>
                ${readonlyInput(item.name)}
                <div class="form-text text-muted">核心信息不可修改</div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">身份证号</label>
                ${readonlyInput(idCard)}
                <div class="form-text text-muted">核心信息不可修改</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">性别</label>
                ${readonlySelect(gender, genderOptions)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">出生日期</label>
                ${readonlyDate(item.birthDate || item.birthday)}
              </div>
              <div class="col-md-6">
                <label class="form-label">年龄</label>
                ${readonlyInput(age ? age + '岁' : '')}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">手机号 <span class="text-danger">*</span></label>
                ${readonlyInput(phoneNum)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">乡镇/街道 <span class="text-danger">*</span></label>
                ${readonlyInput(item.street)}
              </div>
              <div class="col-md-4">
                <label class="form-label">村屯/社区 <span class="text-danger">*</span></label>
                ${readonlyInput(item.community)}
              </div>
              <div class="col-md-4">
                <label class="form-label">居住地小区/自然村 <span class="text-danger">*</span></label>
                ${readonlyInput(item.cell)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12">
                <label class="form-label">具体住址 <span class="text-danger">*</span></label>
                ${readonlyInput(address)}
              </div>
            </div>

            <!-- 代理人信息 -->
            <h6 class="mb-3 text-primary border-bottom pb-2 mt-4">代理人信息</h6>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">代理人姓名</label>
                ${readonlyInput(item.agent)}
              </div>
              <div class="col-md-6">
                <label class="form-label">代理人手机号</label>
                ${readonlyInput(item.agtPhoneNum || item.agentPhone)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">代理人身份证号</label>
                ${readonlyInput(item.agentId)}
              </div>
              <div class="col-md-6">
                <label class="form-label">代理人关系</label>
                ${readonlySelect(item.relation, relationOptions)}
              </div>
            </div>

            <!-- 失能相关信息 -->
            <h6 class="mb-3 text-primary border-bottom pb-2 mt-4">失能相关信息</h6>
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">失能等级</label>
                ${readonlySelect(item.disabilityLevel || item.disLevel, disLevelOptions)}
              </div>
              <div class="col-md-4">
                <label class="form-label">残疾等级</label>
                ${readonlyInput(item.disabledLevel)}
              </div>
              <div class="col-md-4">
                <label class="form-label">失能原因</label>
                ${readonlySelect(item.disReason, disReasonOptions)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">是否低保户</label>
                ${readonlySelect(item.mla ? '1' : '0', yesNoOptions)}
              </div>
              <div class="col-md-6">
                <label class="form-label">是否接收过服务</label>
                ${readonlySelect(item.started ? '1' : '0', yesNoOptions)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">服务状态</label>
                ${readonlyInput(item.serviceStatus || item.status)}
              </div>
              <div class="col-md-6">
                <label class="form-label">负责护理员</label>
                ${readonlyInput(item.nurseName || item.nurseId || '')}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12">
                <label class="form-label">不开始服务说明</label>
                ${readonlyInput(item.noserReason)}
              </div>
            </div>

            <!-- 医保信息 -->
            <h6 class="mb-3 text-primary border-bottom pb-2 mt-4">医保信息</h6>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">医保类型</label>
                ${readonlySelect(item.insureType || item.medicalType, medicalTypeOptions)}
              </div>
              <div class="col-md-6">
                <label class="form-label">是否本省异地参保</label>
                ${readonlySelect(item.otherRegion ? '1' : '0', yesNoOptions)}
              </div>
            </div>

            <!-- 地理信息 -->
            <h6 class="mb-3 text-primary border-bottom pb-2 mt-4">地理信息</h6>
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">地理经度</label>
                <div class="input-group">
                  ${readonlyInput(longitude, '请通过GIS选择')}
                </div>
                <div class="form-text text-muted">经纬度只能通过GIS功能选择</div>
              </div>
              <div class="col-md-4">
                <label class="form-label">地理纬度</label>
                ${readonlyInput(latitude, '请通过GIS选择')}
              </div>
              <div class="col-md-4">
                <label class="form-label">信标地址</label>
                ${readonlyInput(markAddr)}
              </div>
            </div>

            <!-- 日期信息 -->
            <h6 class="mb-3 text-primary border-bottom pb-2 mt-4">日期信息</h6>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label bg-danger text-white px-2 py-1 rounded">外勤上门评估日期 <span class="text-white">*</span></label>
                <input type="date" class="form-control border-danger" value="${item.tabDate || ''}" style="border-left-width: 3px;" readonly>
                <div class="form-text text-danger">红色字段：外勤评估时必须填写</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">机构提交材料日期</label>
                ${readonlyDate(item.subDate)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">医保接受申请日期</label>
                ${readonlyDate(item.reqDate)}
              </div>
              <div class="col-md-6">
                <label class="form-label">医保评估日期</label>
                ${readonlyDate(item.assDate)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">公示日期</label>
                ${readonlyDate(item.pubDate || item.publishDate)}
              </div>
              <div class="col-md-6">
                <label class="form-label">签约送达日期</label>
                ${readonlyDate(item.sigDate)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">首次服务日期</label>
                ${readonlyDate(item.firstDate)}
              </div>
              <div class="col-md-6">
                <label class="form-label">预期首次服务日期</label>
                ${readonlyDate(item.expFirstDate)}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">提供线索的日期</label>
                ${readonlyDate(item.proDate)}
                <div class="form-text text-muted">自行摸排为空</div>
              </div>
            </div>

            <!-- 其他信息 -->
            <h6 class="mb-3 text-primary border-bottom pb-2 mt-4">其他信息</h6>
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">外勤标识</label>
                ${readonlyInput(item.opId || '')}
              </div>
              <div class="col-md-6">
                <label class="form-label">线索提供人 <span class="text-muted">(二选一)</span></label>
                <div class="d-flex gap-2">
                  ${readonlyInput(item.salesId || '', '线索提供人标识')}
                  <span class="align-self-center text-muted">或</span>
                  ${readonlyInput(item.salesName || '', '外部人员姓名')}
                </div>
                <div class="form-text text-muted">线索提供人标识和外部人员只能选择其一</div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12">
                <label class="form-label">来源</label>
                ${readonlyInput(item.source)}
              </div>
            </div>
          </form>
        `;
        
        // 更新详情对象名称
        $('#detailObjectName').text(item.name || '-');
        
        // 更新详情模态框内容
        $('#detailModalBody').html(detailHtml);
        
        // 确保模态框正确显示
        try {
          // 使用jQuery方式显示模态框（更可靠）
          $('#detailModal').modal('show');
          
          // 备用方案：使用Bootstrap 5的Modal API
          setTimeout(function() {
            if (!$('#detailModal').hasClass('show')) {
              const modalElement = document.getElementById('detailModal');
              if (modalElement) {
                const bsModal = bootstrap.Modal.getOrCreateInstance(modalElement);
                if (bsModal) {
                  bsModal.show();
                }
              }
            }
          }, 100);
        } catch (error) {
          console.error('显示详情模态框失败:', error);
          // 最后的备用方案：直接操作DOM
          $('#detailModal').addClass('show').css('display', 'block');
          $('body').addClass('modal-open');
          $('.modal-backdrop').remove();
          $('body').append('<div class="modal-backdrop fade show"></div>');
        }
      });

      // 初始化行政区划级联选择
      function initRegionCascade() {
        // 模拟行政区划数据
        const regionData = {
          '越城区': {
            'XX街道': ['XX社区', 'YY社区'],
            'YY街道': ['AA社区', 'BB社区']
          },
          '柯桥区': {
            'XX街道': ['XX社区', 'YY社区'],
            'XX镇': ['XX村', 'YY村']
          },
          '上虞区': {
            'XX镇': ['XX村', 'YY村'],
            'YY镇': ['AA村', 'BB村']
          },
          '诸暨市': {
            'XX街道': ['XX社区', 'YY社区']
          },
          '嵊州市': {
            'XX街道': ['XX社区', 'YY社区']
          },
          '新昌县': {
            'XX街道': ['XX社区', 'YY社区']
          }
        };
        
        // 街道/乡镇选择变化
        $('#street').change(function() {
          const street = $(this).val();
          $('#community').empty().append('<option value="">全部</option>');
          $('#cell').empty().append('<option value="">全部</option>');
          
          if (street && regionData[street]) {
            Object.keys(regionData[street]).forEach(community => {
              $('#community').append(`<option value="${community}">${community}</option>`);
            });
          }
        });
        
        // 社区/村屯选择变化
        $('#community').change(function() {
          const street = $('#street').val();
          const community = $(this).val();
          $('#cell').empty().append('<option value="">全部</option>');
          
          if (street && community && regionData[street] && regionData[street][community]) {
            regionData[street][community].forEach(cell => {
              $('#cell').append(`<option value="${cell}">${cell}</option>`);
            });
          }
        });
        
        // 初始化街道/乡镇选项
        Object.keys(regionData).forEach(street => {
          $('#street').append(`<option value="${street}">${street}</option>`);
        });
      }

      // 查询数据函数
      function queryData() {
        // 获取筛选条件
        const filters = {
          name: $('#name').val().trim(),
          idCard: $('#idCard').val().trim(),
          street: $('#street').val(),
          community: $('#community').val(),
          cell: $('#cell').val(),
          source: $('#source').val(),
          hasReceivedService: $('#hasReceivedService').val(),
          ageMin: $('#ageMin').val() ? parseInt($('#ageMin').val()) : null,
          ageMax: $('#ageMax').val() ? parseInt($('#ageMax').val()) : null,
          disabilityLevels: $('input[name="disabilityLevel"]:checked').map(function() { return $(this).val(); }).get(),
          serviceStatus: $('#serviceStatus').val(),
          phone: $('#phone').val().trim(),
          sortField: $('#sortField').val(),
          sortOrder: $('#sortOrder').val() || 'asc'
        };
        
        // 模拟完整数据（根据数据库表结构，包含所有字段）
        let mockData = [
          { 
            id: '1', name: '张三', selfid: '330602199001011234', idCard: '330602199001011234', 
            gender: '男', birthday: '1990-01-01', birthDate: '1990-01-01',
            phoneNum: '13800138000', phone: '13800138000',
            street: '越城区', community: 'XX街道', cell: 'XX社区', cellId: 101,
            address: '绍兴市越城区XX路123号', markAddr: 'XX路123号',
            latitude: 120.5820, longitude: 30.0131,
            agent: '张四', agtPhoneNum: '13800138001', agentId: '330602196001011234', relation: '子女',
            fileId: 'YC20250915001',
            disLevel: '重度一级', disabilityLevel: '重度一级', disabledLevel: '肢体残疾一级',
            disReason: '疾病', mla: false,
            started: true, hasReceivedService: '是',
            status: 5, serviceStatus: '正常',
            insureType: '职工医保', medicalType: '职工医保', otherRegion: false,
            tabDate: '2025-09-05', subDate: '2025-09-08', reqDate: '2025-09-10',
            assDate: '2025-09-12', pubDate: '2025-09-15', publishDate: '2025-09-15',
            sigDate: '2025-09-20', firstDate: '2025-09-25', expFirstDate: '2025-09-25',
            proDate: '2025-09-01', source: '村镇提供',
            salesId: 201, salesName: '李销售',
            opId: 301, nurseId: 401, nurseName: '王护理员',
            noserReason: '', createDate: '2025-09-10'
          },
          { 
            id: '2', name: '李四', selfid: '330602198505125678', idCard: '330602198505125678',
            gender: '女', birthday: '1985-05-12', birthDate: '1985-05-12',
            phoneNum: '13900139000', phone: '13900139000',
            street: '柯桥区', community: 'XX街道', cell: 'XX社区', cellId: 102,
            address: '绍兴市柯桥区XX街道456号', markAddr: 'XX街道456号',
            latitude: 120.4950, longitude: 30.0789,
            agent: '李五', agtPhoneNum: '13900139001', agentId: '330602196505125678', relation: '配偶',
            fileId: 'KQ20250920001',
            disLevel: '重度二级', disabilityLevel: '重度二级', disabledLevel: '肢体残疾二级',
            disReason: '意外', mla: true,
            started: true, hasReceivedService: '是',
            status: 5, serviceStatus: '正常',
            insureType: '城乡居民医保', medicalType: '城乡居民医保', otherRegion: false,
            tabDate: '2025-09-10', subDate: '2025-09-15', reqDate: '2025-09-18',
            assDate: '2025-09-18', pubDate: '2025-09-20', publishDate: '2025-09-20',
            sigDate: '2025-09-25', firstDate: '2025-09-30', expFirstDate: '2025-09-30',
            proDate: '', source: '自行摸排',
            salesId: null, salesName: null,
            opId: 302, nurseId: 402, nurseName: '赵护理员',
            noserReason: '', createDate: '2025-09-18'
          },
          { 
            id: '3', name: '王五', selfid: '330602197808259012', idCard: '330602197808259012',
            gender: '男', birthday: '1978-08-25', birthDate: '1978-08-25',
            phoneNum: '13700137000', phone: '13700137000',
            street: '上虞区', community: 'XX镇', cell: 'XX村', cellId: 103,
            address: '绍兴市上虞区XX镇789号', markAddr: 'XX镇789号',
            latitude: 120.8686, longitude: 30.0330,
            agent: '王六', agtPhoneNum: '13700137001', agentId: '330602195808259012', relation: '子女',
            fileId: 'SY20250925001',
            disLevel: '重度三级', disabilityLevel: '重度三级', disabledLevel: '肢体残疾三级',
            disReason: '年老', mla: false,
            started: false, hasReceivedService: '否',
            status: 3, serviceStatus: '暂停',
            insureType: '职工医保', medicalType: '职工医保', otherRegion: true,
            tabDate: '2025-09-15', subDate: '2025-09-20', reqDate: '2025-09-22',
            assDate: '2025-09-22', pubDate: '2025-09-25', publishDate: '2025-09-25',
            sigDate: '2025-09-28', firstDate: null, expFirstDate: '2025-10-05',
            proDate: '2025-09-05', source: '村镇提供',
            salesId: 202, salesName: '张销售',
            opId: 303, nurseId: null, nurseName: null,
            noserReason: '暂不需要服务', createDate: '2025-09-22'
          },
          { 
            id: '4', name: '赵六', selfid: '330602198211303456', idCard: '330602198211303456',
            gender: '女', birthday: '1982-11-30', birthDate: '1982-11-30',
            phoneNum: '13600136000', phone: '13600136000',
            street: '诸暨市', community: 'XX街道', cell: 'XX社区', cellId: 104,
            address: '绍兴市诸暨市XX路321号', markAddr: 'XX路321号',
            latitude: 120.2443, longitude: 29.7136,
            agent: '赵七', agtPhoneNum: '13600136001', agentId: '330602196211303456', relation: '子女',
            fileId: 'ZJ20251005001',
            disLevel: '中度', disabilityLevel: '中度', disabledLevel: null,
            disReason: '疾病', mla: false,
            started: true, hasReceivedService: '是',
            status: 5, serviceStatus: '正常',
            insureType: '职工医保', medicalType: '职工医保', otherRegion: false,
            tabDate: '2025-09-28', subDate: '2025-10-01', reqDate: '2025-10-01',
            assDate: '2025-10-03', pubDate: '2025-10-05', publishDate: '2025-10-05',
            sigDate: '2025-10-08', firstDate: '2025-10-10', expFirstDate: '2025-10-10',
            proDate: '2025-09-20', source: '社区',
            salesId: 203, salesName: '王销售',
            opId: 304, nurseId: 403, nurseName: '李护理员',
            noserReason: '', createDate: '2025-10-01'
          },
          { 
            id: '5', name: '孙七', selfid: '330602199503187890', idCard: '330602199503187890',
            gender: '男', birthday: '1995-03-18', birthDate: '1995-03-18',
            phoneNum: '13500135000', phone: '13500135000',
            street: '嵊州市', community: 'XX街道', cell: 'XX社区', cellId: 105,
            address: '绍兴市嵊州市XX街道654号', markAddr: 'XX街道654号',
            latitude: 120.8283, longitude: 29.6017,
            agent: null, agtPhoneNum: null, agentId: null, relation: null,
            fileId: 'SZ20251010001',
            disLevel: '重度一级', disabilityLevel: '重度一级', disabledLevel: '肢体残疾一级',
            disReason: '意外', mla: false,
            started: false, hasReceivedService: '否',
            status: 7, serviceStatus: '转出',
            insureType: '城乡居民医保', medicalType: '城乡居民医保', otherRegion: false,
            tabDate: '2025-10-01', subDate: '2025-10-05', reqDate: '2025-10-06',
            assDate: '2025-10-08', pubDate: '2025-10-10', publishDate: '2025-10-10',
            sigDate: null, firstDate: null, expFirstDate: null,
            proDate: '2025-09-25', source: '医保',
            salesId: null, salesName: null,
            opId: 305, nurseId: null, nurseName: null,
            noserReason: '', createDate: '2025-10-08'
          },
          { 
            id: '6', name: '周八', selfid: '330602198807224567', idCard: '330602198807224567',
            gender: '女', birthday: '1988-07-22', birthDate: '1988-07-22',
            phoneNum: '13400134000', phone: '13400134000',
            street: '新昌县', community: 'XX街道', cell: 'XX社区', cellId: 106,
            address: '绍兴市新昌县XX路987号', markAddr: 'XX路987号',
            latitude: 120.9058, longitude: 29.4998,
            agent: '周九', agtPhoneNum: '13400134001', agentId: '330602196807224567', relation: '配偶',
            fileId: null,
            disLevel: '轻度', disabilityLevel: '轻度', disabledLevel: null,
            disReason: '年老', mla: false,
            started: true, hasReceivedService: '是',
            status: 5, serviceStatus: '正常',
            insureType: '职工医保', medicalType: '职工医保', otherRegion: false,
            tabDate: '2025-10-05', subDate: '2025-10-10', reqDate: '2025-10-12',
            assDate: '2025-10-12', pubDate: '2025-10-15', publishDate: '2025-10-15',
            sigDate: '2025-10-18', firstDate: '2025-10-20', expFirstDate: '2025-10-20',
            proDate: '', source: '自行摸排',
            salesId: null, salesName: null,
            opId: 306, nurseId: 404, nurseName: '孙护理员',
            noserReason: '', createDate: '2025-10-12'
          },
          { 
            id: '7', name: '吴九', selfid: '330602199201154321', idCard: '330602199201154321',
            gender: '男', birthday: '1992-01-15', birthDate: '1992-01-15',
            phoneNum: '13300133000', phone: '13300133000',
            street: '越城区', community: 'XX街道', cell: 'XX社区', cellId: 107,
            address: '绍兴市越城区XX路555号', markAddr: 'XX路555号',
            latitude: 120.5820, longitude: 30.0131,
            agent: '吴十', agtPhoneNum: '13300133001', agentId: '330602197201154321', relation: '子女',
            fileId: 'YC20251018001',
            disLevel: '重度二级', disabilityLevel: '重度二级', disabledLevel: '肢体残疾二级',
            disReason: '疾病', mla: true,
            started: true, hasReceivedService: '是',
            status: 5, serviceStatus: '正常',
            insureType: '城乡居民医保', medicalType: '城乡居民医保', otherRegion: false,
            tabDate: '2025-10-08', subDate: '2025-10-12', reqDate: '2025-10-15',
            assDate: '2025-10-15', pubDate: '2025-10-18', publishDate: '2025-10-18',
            sigDate: '2025-10-20', firstDate: '2025-10-25', expFirstDate: '2025-10-25',
            proDate: '2025-10-01', source: '村镇提供',
            salesId: 204, salesName: '周销售',
            opId: 307, nurseId: 405, nurseName: '吴护理员',
            noserReason: '', createDate: '2025-10-15'
          },
          { 
            id: '8', name: '郑十', selfid: '330602197512089876', idCard: '330602197512089876',
            gender: '女', birthday: '1975-12-08', birthDate: '1975-12-08',
            phoneNum: '13200132000', phone: '13200132000',
            street: '柯桥区', community: 'XX街道', cell: 'XX社区', cellId: 108,
            address: '绍兴市柯桥区XX街道888号', markAddr: 'XX街道888号',
            latitude: 120.4950, longitude: 30.0789,
            agent: '郑十一', agtPhoneNum: '13200132001', agentId: '330602195512089876', relation: '子女',
            fileId: 'KQ20250928001',
            disLevel: '重度三级', disabilityLevel: '重度三级', disabledLevel: '肢体残疾三级',
            disReason: '年老', mla: false,
            started: false, hasReceivedService: '否',
            status: 10, serviceStatus: '死亡',
            insureType: '职工医保', medicalType: '职工医保', otherRegion: false,
            tabDate: '2025-09-20', subDate: '2025-09-23', reqDate: '2025-09-25',
            assDate: '2025-09-25', pubDate: '2025-09-28', publishDate: '2025-09-28',
            sigDate: '2025-10-01', firstDate: null, expFirstDate: null,
            proDate: '2025-09-15', source: '医保',
            salesId: null, salesName: null,
            opId: 308, nurseId: null, nurseName: null,
            noserReason: '', createDate: '2025-09-25'
          },
        ];
        
        // 应用筛选条件
        allData = mockData.filter(item => {
          // 姓名模糊匹配
          if (filters.name && !item.name.includes(filters.name)) return false;
          
          // 身份证号模糊匹配
          if (filters.idCard && !item.idCard.includes(filters.idCard)) return false;
          
          // 街道/乡镇匹配
          if (filters.street && item.street !== filters.street) return false;
          
          // 社区/村屯匹配
          if (filters.community && item.community !== filters.community) return false;
          
          // 小区/自然村匹配
          if (filters.cell && item.cell !== filters.cell) return false;
          
          // 来源匹配
          if (filters.source && item.source !== filters.source) return false;
          
          // 是否接收过服务匹配（支持started字段和hasReceivedService字段）
          if (filters.hasReceivedService) {
            const hasService = item.started === true || item.hasReceivedService === '是';
            const filterValue = filters.hasReceivedService === '是';
            if (hasService !== filterValue) return false;
          }
          
          // 年龄范围匹配
          if (item.birthDate) {
            const age = calculateAge(item.birthDate);
            if (filters.ageMin !== null && age < filters.ageMin) return false;
            if (filters.ageMax !== null && age > filters.ageMax) return false;
          }
          
          // 失能等级多选匹配
          if (filters.disabilityLevels.length > 0 && !filters.disabilityLevels.includes(item.disabilityLevel)) return false;
          
          // 服务状态匹配
          if (filters.serviceStatus && item.serviceStatus !== filters.serviceStatus) return false;
          
          // 联系电话模糊匹配
          if (filters.phone && (!item.phone || !item.phone.includes(filters.phone))) return false;
          
          return true;
        });
        
        // 应用排序
        if (filters.sortField) {
          allData.sort((a, b) => {
            let aVal, bVal;
            
            switch(filters.sortField) {
              case 'name':
                aVal = a.name || '';
                bVal = b.name || '';
                break;
              case 'age':
                aVal = a.birthDate ? calculateAge(a.birthDate) : 0;
                bVal = b.birthDate ? calculateAge(b.birthDate) : 0;
                break;
              case 'createDate':
                aVal = a.createDate || '';
                bVal = b.createDate || '';
                break;
              case 'publishDate':
                aVal = a.publishDate || '';
                bVal = b.publishDate || '';
                break;
              default:
                return 0;
            }
            
            if (filters.sortOrder === 'asc') {
              return aVal > bVal ? 1 : (aVal < bVal ? -1 : 0);
            } else {
              return aVal < bVal ? 1 : (aVal > bVal ? -1 : 0);
            }
          });
        }
        
        // 更新数据列表
        renderDataList();
      }

      // 渲染数据列表
      function renderDataList() {
        const dataList = $('#dataList');
        dataList.empty();
        
        if (allData.length === 0) {
          dataList.append(`
            <tr>
              <td colspan="14" class="text-center text-muted">没有找到符合条件的数据</td>
            </tr>
          `);
        } else {
          allData.forEach(item => {
            // 计算年龄
            const age = item.birthDate ? calculateAge(item.birthDate) : '-';
            // 获取性别
            const gender = item.gender || (item.idCard && item.idCard.length === 18 ? 
              (parseInt(item.idCard.substr(16, 1)) % 2 === 0 ? '女' : '男') : '-');
            
            // 服务状态标签
            const statusClass = {
              '正常': 'status-normal',
              '暂停': 'status-pause',
              '转出': 'status-transfer',
              '死亡': 'status-death'
            }[item.serviceStatus] || '';
            
            // 构建行政区划显示
            const regionDisplay = [item.street, item.community, item.cell].filter(r => r).join(' / ') || '<span class="text-muted">-</span>';
            
            dataList.append(`
              <tr>
                <td>
                  <input type="checkbox" name="dataItem" value="${item.id}" 
                    ${selectedRows.includes(item.id) ? 'checked' : ''}>
                </td>
                <td>${item.name}</td>
                <td>${item.idCard}</td>
                <td>${gender}</td>
                <td>${age}</td>
                <td>${item.phone || '<span class="text-muted">-</span>'}</td>
                <td>${regionDisplay}</td>
                <td>${item.source || '<span class="text-muted">-</span>'}</td>
                <td>${item.hasReceivedService || '<span class="text-muted">-</span>'}</td>
                <td>${item.disabilityLevel}</td>
                <td>
                  <span class="status-badge ${statusClass}">${item.serviceStatus || '正常'}</span>
                </td>
                <td>${item.publishDate || '<span class="text-muted">-</span>'}</td>
                <td>${item.createDate || '<span class="text-muted">-</span>'}</td>
                <td>
                  <button class="btn btn-sm btn-outline-secondary view-detail-btn" data-id="${item.id}">
                    <i class="fa fa-eye"></i> 查看
                  </button>
                </td>
              </tr>
            `);
          });
        }
        
        // 更新总数显示
        $('#totalCount').text(allData.length);
        
        // 更新全选框状态
        $('#checkAll').prop('checked', false);
      }


      // 显示提示信息
      function showPrompt(title, msg) {
        $('#promptTitle').text(title);
        $('#promptMsg').html(msg);
        promptModal.show();
      }

      // 格式化日期为YYYY-MM-DD
      function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }
      
      // 计算年龄
      function calculateAge(birthDate) {
        if (!birthDate) return '-';
        const birth = new Date(birthDate);
        const today = new Date();
        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
          age--;
        }
        return age;
      }

    });
    
    // ========== 二维码功能 ==========
    // 二维码配置信息（实际项目中应该从后端获取）
    const qrcodeConfig = {
      server: 'http://192.168.1.100',
      port: '8080',
      username: 'admin',
      password: 'admin123456'
    };
    
    // 头像点击事件
    $('#userAvatar').click(function() {
      // 更新显示信息
      $('#qrcodeServer').text(qrcodeConfig.server);
      $('#qrcodePort').text(qrcodeConfig.port);
      $('#qrcodeUsername').text(qrcodeConfig.username);
      $('#qrcodePassword').text('•'.repeat(qrcodeConfig.password.length));
      
      const qrcodeModal = new bootstrap.Modal('#qrcodeModal');
      
      // 等待模态框完全显示后再生成二维码（使用one确保只触发一次）
      $('#qrcodeModal').one('shown.bs.modal', function () {
        generateQRCode();
      });
      
      qrcodeModal.show();
    });
    
    // 生成二维码
    function generateQRCode() {
      // 构建二维码数据（JSON格式）
      const qrcodeData = {
        type: 'app_login',
        server: qrcodeConfig.server,
        port: qrcodeConfig.port,
        username: qrcodeConfig.username,
        password: qrcodeConfig.password,
        timestamp: new Date().getTime()
      };
      
      const qrcodeString = JSON.stringify(qrcodeData);
      
      // 获取canvas元素
      const canvas = document.getElementById('qrcodeCanvas');
      
      // 生成二维码
      QRCode.toCanvas(canvas, qrcodeString, {
        width: 300,
        margin: 2,
        color: {
          dark: '#000000',
          light: '#FFFFFF'
        }
      }, function (error) {
        if (error) {
          console.error('二维码生成失败:', error);
          alert('二维码生成失败，请重试');
        }
      });
    }
    
    // 下载二维码
    $('#downloadQrcodeBtn').click(function() {
      const canvas = document.getElementById('qrcodeCanvas');
      const url = canvas.toDataURL('image/png');
      const link = document.createElement('a');
      link.download = 'app_login_qrcode_' + new Date().getTime() + '.png';
      link.href = url;
      link.click();
    });
  </script>
  
  <!-- 二维码模态框 -->
  <div class="modal fade qrcode-modal" id="qrcodeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fa fa-qrcode"></i> App登录二维码
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="qrcode-container">
            <canvas id="qrcodeCanvas"></canvas>
          </div>
          <div class="qrcode-info">
            <div class="qrcode-info-item">
              <span class="qrcode-info-label">服务地址：</span>
              <span class="qrcode-info-value" id="qrcodeServer">http://192.168.1.100</span>
            </div>
            <div class="qrcode-info-item">
              <span class="qrcode-info-label">端口：</span>
              <span class="qrcode-info-value" id="qrcodePort">8080</span>
            </div>
            <div class="qrcode-info-item">
              <span class="qrcode-info-label">账号：</span>
              <span class="qrcode-info-value" id="qrcodeUsername">admin</span>
            </div>
            <div class="qrcode-info-item">
              <span class="qrcode-info-label">密码：</span>
              <span class="qrcode-info-value" id="qrcodePassword">••••••••</span>
            </div>
          </div>
          <div class="qrcode-tip">
            <i class="fa fa-info-circle"></i> 使用手机App扫描此二维码即可自动配置登录信息
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">关闭</button>
          <button type="button" class="btn btn-primary" id="downloadQrcodeBtn">
            <i class="fa fa-download"></i> 下载二维码
          </button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>